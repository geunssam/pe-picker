<div id="page-group-manager" class="page-view">
  <div class="page-header">
    <div>
      <div class="page-title">모둠뽑기</div>
      <div class="page-subtitle">학생들을 모둠으로 랜덤 배정합니다</div>
    </div>
  </div>

  <!-- ============ Phase 1: 설정 화면 ============ -->
  <div id="gm-phase1">
    <!-- 뽑기 설정 카드 -->
    <div class="section">
      <div class="section-title" style="justify-content: space-between">
        <span
          ><svg
            class="icon"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="3" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
            />
          </svg>
          뽑기 설정</span
        >
        <div style="display: flex; align-items: center; gap: var(--space-sm)">
          <div class="gm-radio-inline" style="gap: var(--space-md)">
            <label class="gm-radio-compact">
              <input
                type="radio"
                name="gm-composition-mode"
                id="gm-mode-random"
                value="random"
                checked
              />
              <span
                ><svg
                  class="icon"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22" />
                  <path d="m18 2 4 4-4 4" />
                  <path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2" />
                  <path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8" />
                  <path d="m18 14 4 4-4 4" />
                </svg>
                랜덤</span
              >
            </label>
            <label class="gm-radio-compact">
              <input type="radio" name="gm-composition-mode" id="gm-mode-fixed" value="fixed" />
              <span
                ><svg
                  class="icon"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="12" y1="17" x2="12" y2="22" />
                  <path
                    d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"
                  />
                </svg>
                고정</span
              >
            </label>
          </div>
        </div>
      </div>
      <div class="glass-card" style="padding: var(--space-lg)">
        <!-- 모둠당 인원 / 모둠 개수 / 분 / 초 (2×2) -->
        <div class="tag-settings-4col">
          <div class="tag-setting-item">
            <div class="setting-label">모둠당 인원</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="gm-group-size" data-dir="down">−</button>
              <input type="number" id="gm-group-size" value="4" min="2" max="10" />
              <button class="stepper-btn" data-target="gm-group-size" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">모둠 개수</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="gm-group-count" data-dir="down">−</button>
              <input type="number" id="gm-group-count" value="5" min="1" max="12" />
              <button class="stepper-btn" data-target="gm-group-count" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">분</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="gm-timer-min" data-dir="down">−</button>
              <input type="number" id="gm-timer-min" value="3" min="0" max="10" />
              <button class="stepper-btn" data-target="gm-timer-min" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">초</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="gm-timer-sec" data-dir="down">−</button>
              <input type="number" id="gm-timer-sec" value="0" min="0" max="59" />
              <button class="stepper-btn" data-target="gm-timer-sec" data-dir="up">+</button>
            </div>
          </div>
        </div>

        <!-- 고정 모드 안내 (조건부) -->
        <div id="gm-fixed-mode-info" style="display: none; margin: var(--space-md) 0 0">
          <div class="gm-info-box" style="margin: 0">
            고정 모둠 모드: 학급 설정의 모둠 구성을 사용합니다.
          </div>
          <div style="display: flex; gap: var(--space-lg); margin-top: var(--space-sm)">
            <label class="gm-checkbox-compact">
              <input type="checkbox" id="gm-fixed-shuffle-order" checked />
              <span>모둠 순서 섞기</span>
            </label>
            <label class="gm-checkbox-compact">
              <input type="checkbox" id="gm-fixed-shuffle-members" />
              <span>모둠 내 순서 섞기</span>
            </label>
          </div>
        </div>

        <!-- 모둠 이름 설정 -->
        <div
          style="
            margin-top: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
          "
        >
          <span style="font-size: var(--font-size-sm); font-weight: 600; white-space: nowrap"
            ><svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"
              />
              <path d="M7 7h.01" />
            </svg>
            이름</span
          >
          <select id="gm-naming-mode" class="input input-sm" style="flex: 1">
            <option value="number">숫자순 (1모둠, 2모둠...)</option>
            <option value="class">학급 설정 이름 사용</option>
            <option value="custom">즉석 커스텀</option>
          </select>
        </div>

        <!-- 학급 이름 랜덤 섞기 옵션 (조건부) -->
        <div id="gm-class-name-select-container" style="display: none; margin-top: var(--space-sm)">
          <!-- 숨겨진 요소들 (하위 호환성) -->
          <select id="gm-class-name-select" class="input input-sm" style="display: none">
            <option value="">학급 선택...</option>
          </select>
          <input type="checkbox" id="gm-use-fixed-teams" style="display: none" />
          <label class="gm-checkbox-compact">
            <input type="checkbox" id="gm-random-names" />
            <span>(이름만) 랜덤 섞기</span>
          </label>
        </div>

        <!-- 커스텀 이름 입력 (조건부) -->
        <div id="gm-custom-names-container" style="display: none; margin-top: var(--space-sm)">
          <div class="gm-custom-grid">
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="1모둠"
              maxlength="10"
            />
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="2모둠"
              maxlength="10"
            />
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="3모둠"
              maxlength="10"
            />
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="4모둠"
              maxlength="10"
            />
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="5모둠"
              maxlength="10"
            />
            <input
              class="input input-sm gm-custom-name"
              type="text"
              placeholder="6모둠"
              maxlength="10"
            />
          </div>
        </div>

        <!-- 계산 정보 -->
        <div id="gm-calc-info" class="student-info gm-calc-compact"></div>
      </div>
    </div>

    <!-- 뽑을 학생 설정 카드 (술래뽑기와 동일 구조) -->
    <div class="section">
      <div class="section-title">
        <svg
          class="icon"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
          <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
        </svg>
        뽑을 학생 설정
      </div>
      <div class="glass-card" style="padding: var(--space-lg)">
        <input type="hidden" id="gm-student-count" value="20" />

        <!-- 3개 버튼: 번호순 생성 / 학급 불러오기 / 성별 구분 -->
        <div class="tag-student-gen-buttons">
          <button class="btn btn-secondary btn-sm" id="gm-gen-by-number">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="10" y1="6" x2="21" y2="6" />
              <line x1="10" y1="12" x2="21" y2="12" />
              <line x1="10" y1="18" x2="21" y2="18" />
              <path d="M4 6h1v4" />
              <path d="M4 10h2" />
              <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1" />
            </svg>
            번호순 생성
          </button>
          <button class="btn btn-secondary btn-sm" id="gm-gen-by-class">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
            </svg>
            학급 불러오기
          </button>
          <button class="btn btn-secondary btn-sm" id="gm-gen-by-gender">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
            성별 구분
          </button>
        </div>

        <!-- 학생 카드 영역 (조건부 표시) -->
        <div id="gm-student-cards-wrapper" style="display: none">
          <div id="gm-student-cards" class="tag-student-cards"></div>
        </div>

        <!-- 학생 없을 때 안내 -->
        <div id="gm-no-students-message" class="tag-empty-message">
          <p
            style="
              font-size: var(--font-size-sm);
              color: var(--text-tertiary);
              text-align: center;
              padding: var(--space-lg);
            "
          >
            위 버튼으로 학생을 추가해주세요
          </p>
        </div>
      </div>
    </div>

    <!-- 모둠 뽑기 버튼 -->
    <div class="tag-action-buttons">
      <button class="btn btn-primary" id="gm-pick-btn">
        <svg
          class="icon"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22" />
          <path d="m18 2 4 4-4 4" />
          <path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2" />
          <path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8" />
          <path d="m18 14 4 4-4 4" />
        </svg>
        모둠 뽑기!
      </button>
      <button class="btn btn-secondary" id="gm-back-to-result-btn" style="display: none">
        <svg
          class="icon"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M12 20V10M18 20V4M6 20v-4" />
        </svg>
        결과로 돌아가기
      </button>
      <button class="btn btn-danger" id="gm-reset-from-settings-btn" style="display: none">
        <svg
          class="icon"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
          <path d="M3 3v5h5" />
        </svg>
        초기화
      </button>
    </div>
  </div>

  <!-- ============ Phase 2: 타이머 + 결과 ============ -->

  <!-- 타이머 (Phase 2 상단, 토글) -->
  <div id="gm-timer-section" class="section" style="display: none">
    <div class="section-title">
      <svg
        class="icon"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="13" r="8" />
        <path d="M12 9v4l2 2" />
        <path d="M5 3 2 6M22 6l-3-3M6.38 18.7 4 21M17.64 18.67 20 21" />
      </svg>
      타이머
    </div>
    <!-- 일반 모드: 인라인 타이머 -->
    <div id="gm-timer-inline" class="glass-card" style="padding: var(--space-lg)">
      <div
        class="gm-timer-presets"
        style="display: flex; gap: var(--space-sm); flex-wrap: wrap; margin-bottom: var(--space-md)"
      >
        <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="30">30초</button>
        <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="60">1분</button>
        <button class="btn btn-sm btn-secondary gm-timer-preset active" data-seconds="180">
          3분
        </button>
        <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="300">5분</button>
        <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="600">10분</button>
      </div>
      <div style="display: flex; align-items: center; gap: var(--space-md)">
        <div id="gm-timer-display" class="gm-timer-display">03:00</div>
        <div style="display: flex; gap: var(--space-sm); flex: 1">
          <button class="btn btn-sm btn-primary" id="gm-timer-start" style="flex: 1">
            <svg
              class="icon"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polygon points="5 3 19 12 5 21 5 3" />
            </svg>
            시작
          </button>
          <button
            class="btn btn-sm btn-secondary"
            id="gm-timer-pause"
            style="flex: 1; display: none"
          >
            <svg
              class="icon"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="6" y="4" width="4" height="16" />
              <rect x="14" y="4" width="4" height="16" />
            </svg>
            일시정지
          </button>
          <button class="btn btn-sm btn-secondary" id="gm-timer-reset">↺</button>
        </div>
      </div>
      <div style="margin-top: var(--space-md); text-align: center">
        <button class="btn btn-sm btn-secondary" id="gm-timer-fullscreen">
          <svg
            class="icon"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
            />
          </svg>
          전체화면 타이머
        </button>
      </div>
    </div>

    <!-- 전체화면 모드: 술래뽑기와 동일한 레이아웃 -->
    <div id="gm-timer-phase" class="tag-timer-phase" style="display: none">
      <div class="tag-timer-display-wrapper">
        <div class="tag-timer-label">남은 시간</div>
        <div id="gm-fs-timer-display" class="tag-timer-display timer-normal">03:00</div>
      </div>
      <!-- 전체화면 내 휘슬 버튼 -->
      <div class="timer-whistle-wrap">
        <button class="timer-whistle-btn" id="gm-timer-whistle-btn">
          <span class="timer-whistle-btn__icon"
            ><svg
              class="icon"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m3 11 18-5v12L3 13v-2z" />
              <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6" /></svg
          ></span>
        </button>
        <div class="timer-whistle-ring" id="gm-timer-whistle-ring1"></div>
        <div class="timer-whistle-ring" id="gm-timer-whistle-ring2"></div>
        <div class="timer-whistle-mode-row">
          <button
            class="timer-whistle-mode timer-whistle-mode--active"
            data-mode="hold"
            data-gm-whistle-mode
          >
            꾹
          </button>
          <button class="timer-whistle-mode" data-mode="long" data-gm-whistle-mode>삐—</button>
          <button class="timer-whistle-mode" data-mode="triple" data-gm-whistle-mode>삐삐삐</button>
        </div>
      </div>
      <div class="tag-timer-sub-controls">
        <button class="btn btn-sm btn-secondary" id="gm-timer-fs-close">축소</button>
        <button class="btn btn-sm btn-secondary" id="gm-timer-fs-toggle">
          <svg
            class="icon"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="6" y="4" width="4" height="16" />
            <rect x="14" y="4" width="4" height="16" />
          </svg>
          일시정지
        </button>
        <button class="btn btn-sm btn-danger" id="gm-timer-fs-end">타이머 종료</button>
      </div>
    </div>
  </div>

  <!-- 결과 영역 -->
  <div id="gm-result-section" style="display: none">
    <div class="section-title">
      <svg
        class="icon"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="10" />
        <circle cx="12" cy="12" r="6" />
        <circle cx="12" cy="12" r="2" />
      </svg>
      모둠 뽑기 결과
    </div>
    <div id="gm-groups-container" class="gm-groups-container"></div>
  </div>

  <!-- Phase 2 액션 버튼 (4열 그리드) -->
  <div id="gm-phase2-actions" class="tag-phase2-grid" style="display: none">
    <button class="btn btn-primary" id="gm-timer-toggle-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="13" r="8" />
        <path d="M12 9v4l2 2" />
        <path d="M5 3 2 6M22 6l-3-3M6.38 18.7 4 21M17.64 18.67 20 21" />
      </svg>
      타이머
    </button>
    <button class="btn btn-secondary" id="gm-pick-again-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22" />
        <path d="m18 2 4 4-4 4" />
        <path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2" />
        <path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8" />
        <path d="m18 14 4 4-4 4" />
      </svg>
      다시뽑기
    </button>
    <button class="btn btn-secondary" id="gm-back-to-setup-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
        <path d="m15 5 4 4" />
      </svg>
      설정
    </button>
    <button class="btn btn-danger" id="gm-reset-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
        <path d="M3 3v5h5" />
      </svg>
      초기화
    </button>
  </div>
</div>
