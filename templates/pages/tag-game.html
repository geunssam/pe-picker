<div id="page-tag-game" class="page-view">
  <!-- 헤더 -->
  <div class="page-header">
    <div>
      <div class="page-title">술래뽑기</div>
      <div class="page-subtitle">술래와 천사를 랜덤으로 뽑습니다</div>
    </div>
  </div>

  <!-- 라운드 표시 (Phase 2/3) -->
  <div id="tag-round-display" class="tag-round-display" style="display: none">ROUND 1</div>

  <!-- ============ Phase 1: 설정 화면 ============ -->
  <div id="tag-phase1">
    <!-- 뽑기 설정 카드 -->
    <div class="section">
      <div class="section-title" style="justify-content: space-between">
        <span
          ><svg
            class="icon"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="3" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
            />
          </svg>
          뽑기 설정</span
        >
        <div style="display: flex; align-items: center; gap: var(--space-sm); flex-shrink: 0">
          <span
            style="font-size: var(--font-size-sm); color: var(--text-secondary); font-weight: 500"
            >중복 제외</span
          >
          <label class="toggle">
            <input type="checkbox" id="tag-exclude-prev" />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="glass-card" style="padding: var(--space-lg)">
        <!-- 술래 수 / 천사 수 / 분 / 초 (2×2) -->
        <div class="tag-settings-4col">
          <div class="tag-setting-item">
            <div class="setting-label">술래 수</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="tag-it-count" data-dir="down">−</button>
              <input type="number" id="tag-it-count" value="1" min="0" max="10" />
              <button class="stepper-btn" data-target="tag-it-count" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">천사 수</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="tag-angel-count" data-dir="down">−</button>
              <input type="number" id="tag-angel-count" value="0" min="0" max="10" />
              <button class="stepper-btn" data-target="tag-angel-count" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">분</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="tag-timer-min" data-dir="down">−</button>
              <input type="number" id="tag-timer-min" value="0" min="0" max="10" />
              <button class="stepper-btn" data-target="tag-timer-min" data-dir="up">+</button>
            </div>
          </div>
          <div class="tag-setting-item">
            <div class="setting-label">초</div>
            <div class="number-stepper">
              <button class="stepper-btn" data-target="tag-timer-sec" data-dir="down">−</button>
              <input type="number" id="tag-timer-sec" value="30" min="0" max="59" />
              <button class="stepper-btn" data-target="tag-timer-sec" data-dir="up">+</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 뽑을 학생 설정 카드 -->
    <div class="section">
      <div class="section-title">
        <svg
          class="icon"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
          <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
        </svg>
        뽑을 학생 설정
      </div>
      <div class="glass-card" style="padding: var(--space-lg)">
        <!-- 학생 수 (hidden, JS에서 참조용) -->
        <input type="hidden" id="tag-student-count" value="20" />

        <!-- 3개 버튼: 번호순 생성 / 학급 불러오기 / 성별 구분 -->
        <div class="tag-student-gen-buttons">
          <button class="btn btn-secondary btn-sm" id="tag-gen-by-number">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="10" y1="6" x2="21" y2="6" />
              <line x1="10" y1="12" x2="21" y2="12" />
              <line x1="10" y1="18" x2="21" y2="18" />
              <path d="M4 6h1v4" />
              <path d="M4 10h2" />
              <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1" />
            </svg>
            번호순 생성
          </button>
          <button class="btn btn-secondary btn-sm" id="tag-gen-by-class">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"
              />
            </svg>
            학급 불러오기
          </button>
          <button class="btn btn-secondary btn-sm" id="tag-gen-by-gender">
            <svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
            성별 구분
          </button>
        </div>

        <!-- 학생 카드 영역 (조건부 표시) -->
        <div id="tag-student-cards-wrapper" style="display: none">
          <div id="tag-student-cards" class="tag-student-cards"></div>
        </div>

        <!-- 학생 없을 때 안내 -->
        <div id="tag-no-students-message" class="tag-empty-message">
          <p
            style="
              font-size: var(--font-size-sm);
              color: var(--text-tertiary);
              text-align: center;
              padding: var(--space-lg);
            "
          >
            위 버튼으로 학생을 추가해주세요
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 1 전용 버튼 -->
  <div id="tag-phase1-actions" class="tag-action-buttons">
    <button class="btn btn-primary" id="tag-start-btn">
      <svg
        class="icon"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polygon points="5 3 19 12 5 21 5 3" />
      </svg>
      술래 뽑기!
    </button>
    <button class="btn btn-secondary" id="tag-back-to-result-btn" style="display: none">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M12 20V10M18 20V4M6 20v-4" />
      </svg>
      결과로 돌아가기
    </button>
    <button class="btn btn-danger" id="tag-reset-from-settings-btn" style="display: none">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
        <path d="M3 3v5h5" />
      </svg>
      초기화
    </button>
  </div>

  <!-- ============ Phase 2: 결과 섹션 ============ -->
  <div id="tag-result-section" style="display: none">
    <div class="section">
      <div
        class="section-title"
        style="display: flex; align-items: center; justify-content: space-between"
      >
        <span
          ><svg
            class="icon"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <circle cx="12" cy="12" r="6" />
            <circle cx="12" cy="12" r="2" />
          </svg>
          뽑힌 결과</span
        >
        <button class="tag-badge-btn" id="tag-badge-btn" style="display: none">
          <svg
            class="icon"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="16" r="6" />
            <path d="M8.523 11.11 7 2l5 3 5-3-1.523 9.11" />
          </svg>
          배지 부여
        </button>
      </div>
      <div id="tag-result-container" class="tag-result-container"></div>
    </div>
  </div>

  <!-- ============ Phase 2: 후보/이력 (폴딩식) ============ -->
  <div id="tag-phase2-content" style="display: none">
    <!-- 후보 섹션 -->
    <div class="section">
      <div class="tag-collapsible">
        <button class="tag-collapse-toggle" data-target="tag-next-its">
          <span
            ><svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="5" r="2" />
              <path d="m7 21 3-9m0 0 2-2 4-1m-6 3-2.5-3.5L10 7l4.5 1.5M17 21l-2-8" />
            </svg>
            다음 술래 후보 (<span id="tag-next-its-count">0</span>명)</span
          >
          <span class="collapse-arrow">▼</span>
        </button>
        <div id="tag-next-its" class="tag-collapse-content" style="display: none"></div>
      </div>
      <div class="tag-collapsible">
        <button class="tag-collapse-toggle" data-target="tag-next-angels">
          <span
            ><svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 2a3 3 0 0 0 0 6 3 3 0 0 0 0-6z" />
              <path d="M12 8c-3 0-5 2-5 5v6h10v-6c0-3-2-5-5-5z" />
              <path d="M8 2.5C6.5 3.5 6 5 6 5" />
              <path d="M16 2.5c1.5 1 2 2.5 2 2.5" />
            </svg>
            다음 천사 후보 (<span id="tag-next-angels-count">0</span>명)</span
          >
          <span class="collapse-arrow">▼</span>
        </button>
        <div id="tag-next-angels" class="tag-collapse-content" style="display: none"></div>
      </div>
    </div>

    <!-- 이력 섹션 -->
    <div class="section">
      <div class="tag-collapsible">
        <button class="tag-collapse-toggle" data-target="tag-history-its">
          <span
            ><svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4" />
              <path d="M19 3H8a2 2 0 0 0-2 2v12" />
            </svg>
            지난 술래 (<span id="tag-history-its-count">0</span>명)</span
          >
          <span class="collapse-arrow">▼</span>
        </button>
        <div id="tag-history-its" class="tag-collapse-content" style="display: none"></div>
      </div>
      <div class="tag-collapsible">
        <button class="tag-collapse-toggle" data-target="tag-history-angels">
          <span
            ><svg
              class="icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4" />
              <path d="M19 3H8a2 2 0 0 0-2 2v12" />
            </svg>
            지난 천사 (<span id="tag-history-angels-count">0</span>명)</span
          >
          <span class="collapse-arrow">▼</span>
        </button>
        <div id="tag-history-angels" class="tag-collapse-content" style="display: none"></div>
      </div>
    </div>
  </div>

  <!-- Phase 2 전용 버튼 -->
  <div id="tag-phase2-actions" class="tag-phase2-grid" style="display: none">
    <button class="btn btn-primary" id="tag-timer-start-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polygon points="5 3 19 12 5 21 5 3" />
      </svg>
      게임 시작
    </button>
    <button class="btn btn-secondary" id="tag-pick-again-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22" />
        <path d="m18 2 4 4-4 4" />
        <path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2" />
        <path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8" />
        <path d="m18 14 4 4-4 4" />
      </svg>
      다시뽑기
    </button>
    <button class="btn btn-secondary" id="tag-modify-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
        <path d="m15 5 4 4" />
      </svg>
      설정
    </button>
    <button class="btn btn-danger" id="tag-new-game-btn">
      <svg
        class="icon"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
        <path d="M3 3v5h5" />
      </svg>
      초기화
    </button>
  </div>

  <!-- ============ Phase 3: 타이머 ============ -->
  <div id="tag-timer-phase" class="tag-timer-phase" style="display: none">
    <div class="tag-timer-display-wrapper">
      <div class="tag-timer-label">남은 시간</div>
      <div id="tag-timer-display" class="tag-timer-display timer-normal">00:00</div>
    </div>
    <!-- 전체화면 타이머 내 휘슬 버튼 -->
    <div id="tag-timer-whistle" class="timer-whistle-wrap">
      <button class="timer-whistle-btn" id="tag-timer-whistle-btn">
        <span class="timer-whistle-btn__icon"
          ><svg
            class="icon"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m3 11 18-5v12L3 13v-2z" />
            <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6" /></svg
        ></span>
      </button>
      <div class="timer-whistle-ring" id="tag-timer-whistle-ring1"></div>
      <div class="timer-whistle-ring" id="tag-timer-whistle-ring2"></div>
      <div class="timer-whistle-mode-row">
        <button
          class="timer-whistle-mode timer-whistle-mode--active"
          data-mode="hold"
          data-whistle-mode
        >
          꾹
        </button>
        <button class="timer-whistle-mode" data-mode="long" data-whistle-mode>삐—</button>
        <button class="timer-whistle-mode" data-mode="triple" data-whistle-mode>삐삐삐</button>
      </div>
    </div>
    <div class="tag-timer-sub-controls">
      <button class="btn btn-sm btn-secondary" id="tag-timer-fullscreen-toggle">축소</button>
      <button class="btn btn-sm btn-secondary" id="tag-timer-pause">
        <svg
          class="icon"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="6" y="4" width="4" height="16" />
          <rect x="14" y="4" width="4" height="16" />
        </svg>
        일시정지
      </button>
      <button class="btn btn-sm btn-danger" id="tag-timer-end">타이머 종료</button>
    </div>
  </div>
</div>
