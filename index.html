<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#FFF9F0">
  <title>체육 수업 도우미</title>
  <link rel="manifest" href="manifest.json">

  <!-- Fonts -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">

  <!-- Styles -->
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/tag-game.css">
  <link rel="stylesheet" href="css/group-manager.css">
</head>

<body>

  <!-- 상단 네비바 -->
  <header class="top-navbar">
    <div class="navbar-left">
      <h1 class="navbar-title">🎰 만능 뽑기</h1>
    </div>
    <nav class="navbar-tabs">
      <button data-route="tag-game" class="navbar-tab active">
        <svg class="nav-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="10" cy="7" r="3" />
          <path d="M4 18c0-3 2.5-5.5 6-5.5s6 2.5 6 5.5" />
        </svg>
        <span>술래뽑기</span>
      </button>
      <button data-route="group-manager" class="navbar-tab">
        <svg class="nav-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="7" cy="7" r="2.5" />
          <circle cx="13" cy="7" r="2.5" />
          <path d="M2 16.5c0-2.5 2-4.5 5-4.5s5 2 5 4.5" />
          <path d="M12 12c2.5 0 4.5 1.8 4.5 4" />
        </svg>
        <span>모둠뽑기</span>
      </button>
      <button data-route="settings" class="navbar-tab">
        <svg class="nav-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="2" width="14" height="16" rx="2" />
          <line x1="7" y1="6" x2="13" y2="6" />
          <line x1="7" y1="10" x2="13" y2="10" />
          <line x1="7" y1="14" x2="10" y2="14" />
        </svg>
        <span>학급관리</span>
      </button>
    </nav>
  </header>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Picking Overlay -->
  <div id="picking-overlay" class="picking-overlay">
    <div class="picking-emoji" id="picking-emoji">🎲</div>
    <div class="picking-text" id="picking-text">뽑는 중...</div>
  </div>

  <!-- App Container -->
  <div class="app-container">

    <!-- ===================================================================
         ==================== 술래뽑기 페이지 ====================
         =================================================================== -->
    <div id="page-tag-game" class="page-view">

      <!-- 헤더 -->
      <div class="page-header">
        <div>
          <div class="page-title">술래뽑기</div>
          <div class="page-subtitle">술래와 천사를 랜덤으로 뽑습니다</div>
        </div>
      </div>

      <!-- 라운드 표시 (Phase 2/3) -->
      <div id="tag-round-display" class="tag-round-display" style="display:none;">ROUND 1</div>

      <!-- ============ Phase 1: 설정 화면 ============ -->
      <div id="tag-phase1">

        <!-- 뽑기 설정 카드 -->
        <div class="section">
          <div class="section-title" style="justify-content: space-between;">
            <span>⚙️ 뽑기 설정</span>
            <div style="display: flex; align-items: center; gap: var(--space-sm); flex-shrink: 0;">
              <span style="font-size: var(--font-size-sm); color: var(--text-secondary); font-weight: 500;">중복 제외</span>
              <label class="toggle">
                <input type="checkbox" id="tag-exclude-prev">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="glass-card" style="padding: var(--space-lg);">

            <!-- 술래 수 / 천사 수 / 분 / 초 (2×2) -->
            <div class="tag-settings-4col">
              <div class="tag-setting-item">
                <div class="setting-label">술래 수</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="tag-it-count" data-dir="down">−</button>
                  <input type="number" id="tag-it-count" value="1" min="0" max="10">
                  <button class="stepper-btn" data-target="tag-it-count" data-dir="up">+</button>
                </div>
              </div>
              <div class="tag-setting-item">
                <div class="setting-label">천사 수</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="tag-angel-count" data-dir="down">−</button>
                  <input type="number" id="tag-angel-count" value="0" min="0" max="10">
                  <button class="stepper-btn" data-target="tag-angel-count" data-dir="up">+</button>
                </div>
              </div>
              <div class="tag-setting-item">
                <div class="setting-label">분</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="tag-timer-min" data-dir="down">−</button>
                  <input type="number" id="tag-timer-min" value="0" min="0" max="10">
                  <button class="stepper-btn" data-target="tag-timer-min" data-dir="up">+</button>
                </div>
              </div>
              <div class="tag-setting-item">
                <div class="setting-label">초</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="tag-timer-sec" data-dir="down">−</button>
                  <input type="number" id="tag-timer-sec" value="30" min="0" max="59">
                  <button class="stepper-btn" data-target="tag-timer-sec" data-dir="up">+</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 뽑을 학생 설정 카드 -->
        <div class="section">
          <div class="section-title">📋 뽑을 학생 설정</div>
          <div class="glass-card" style="padding: var(--space-lg);">

            <!-- 학생 수 (hidden, JS에서 참조용) -->
            <input type="hidden" id="tag-student-count" value="20">

            <!-- 3개 버튼: 번호순 생성 / 성별 구분 / 학급 불러오기 -->
            <div class="tag-student-gen-buttons">
              <button class="btn btn-secondary btn-sm" id="tag-gen-by-number">📝 번호순 생성</button>
              <button class="btn btn-secondary btn-sm" id="tag-gen-by-gender">👫 성별 구분</button>
              <button class="btn btn-secondary btn-sm" id="tag-gen-by-class">📋 학급 불러오기</button>
            </div>

            <!-- 학급 select (숨겨진 상태 - 학급 불러오기 모달에서 사용) -->
            <select id="tag-class-select" style="display: none;">
              <option value="">학급 선택...</option>
            </select>

            <!-- 학생 카드 영역 -->
            <div id="tag-student-cards" class="tag-student-cards"></div>
          </div>
        </div>

      </div>

      <!-- Phase 1 전용 버튼 -->
      <div id="tag-phase1-actions" class="tag-action-buttons">
        <button class="btn btn-primary btn-lg" id="tag-start-btn" style="width: 100%;">
          🎮 술래 뽑기!
        </button>
        <button class="btn btn-secondary" id="tag-back-to-result-btn" style="width: 100%; display: none;">
          📊 결과로 돌아가기
        </button>
        <button class="btn btn-danger btn-sm" id="tag-reset-from-settings-btn" style="width: 100%; display: none;">
          🧹 새 게임 (이력 초기화)
        </button>
      </div>

      <!-- ============ Phase 2: 결과 섹션 ============ -->
      <div id="tag-result-section" style="display: none;">
        <div class="section">
          <div class="section-title">🎯 뽑힌 결과</div>
          <div id="tag-result-container" class="tag-result-container"></div>
        </div>
      </div>

      <!-- ============ Phase 2: 후보/이력 (폴딩식) ============ -->
      <div id="tag-phase2-content" style="display: none;">
        <!-- 후보 섹션 -->
        <div class="section">
          <div class="tag-collapsible">
            <button class="tag-collapse-toggle" data-target="tag-next-its">
              <span>🏃 다음 술래 후보 (<span id="tag-next-its-count">0</span>명)</span>
              <span class="collapse-arrow">▼</span>
            </button>
            <div id="tag-next-its" class="tag-collapse-content" style="display: none;"></div>
          </div>
          <div class="tag-collapsible">
            <button class="tag-collapse-toggle" data-target="tag-next-angels">
              <span>😇 다음 천사 후보 (<span id="tag-next-angels-count">0</span>명)</span>
              <span class="collapse-arrow">▼</span>
            </button>
            <div id="tag-next-angels" class="tag-collapse-content" style="display: none;"></div>
          </div>
        </div>

        <!-- 이력 섹션 -->
        <div class="section">
          <div class="tag-collapsible">
            <button class="tag-collapse-toggle" data-target="tag-history-its">
              <span>📜 지난 술래 (<span id="tag-history-its-count">0</span>명)</span>
              <span class="collapse-arrow">▼</span>
            </button>
            <div id="tag-history-its" class="tag-collapse-content" style="display: none;"></div>
          </div>
          <div class="tag-collapsible">
            <button class="tag-collapse-toggle" data-target="tag-history-angels">
              <span>📜 지난 천사 (<span id="tag-history-angels-count">0</span>명)</span>
              <span class="collapse-arrow">▼</span>
            </button>
            <div id="tag-history-angels" class="tag-collapse-content" style="display: none;"></div>
          </div>
        </div>
      </div>

      <!-- Phase 2 전용 버튼 -->
      <div id="tag-phase2-actions" class="tag-phase2-grid" style="display: none;">
        <button class="btn btn-primary" id="tag-timer-start-btn">🎮 게임 시작</button>
        <button class="btn btn-secondary" id="tag-pick-again-btn">🎲 다시뽑기</button>
        <button class="btn btn-secondary" id="tag-modify-btn">✏️ 설정</button>
        <button class="btn btn-danger" id="tag-new-game-btn">🧹 초기화</button>
      </div>

      <!-- ============ Phase 3: 타이머 ============ -->
      <div id="tag-timer-phase" class="tag-timer-phase" style="display: none;">
        <div class="tag-timer-display-wrapper">
          <div class="tag-timer-label">남은 시간</div>
          <div id="tag-timer-display" class="tag-timer-display timer-normal">00:00</div>
        </div>
        <div class="tag-timer-controls">
          <button class="btn btn-secondary" id="tag-timer-pause">⏸️ 일시정지</button>
        </div>
        <div class="tag-timer-sub-controls">
          <button class="btn btn-sm btn-secondary" id="tag-timer-minimize">축소</button>
          <button class="btn btn-sm btn-secondary" id="tag-timer-maximize">전체화면</button>
          <button class="btn btn-sm btn-secondary" id="tag-timer-back-result">결과보기</button>
          <button class="btn btn-sm btn-secondary" id="tag-timer-back-setup">설정</button>
          <button class="btn btn-sm btn-danger" id="tag-timer-new-game">초기화</button>
        </div>
      </div>

    </div>

    <!-- ===================================================================
         ==================== 모둠뽑기 페이지 ====================
         =================================================================== -->
    <div id="page-group-manager" class="page-view">
      <div class="page-header">
        <div>
          <div class="page-title">모둠뽑기</div>
          <div class="page-subtitle">학생들을 모둠으로 랜덤 배정합니다</div>
        </div>
      </div>

      <!-- ============ Phase 1: 설정 화면 ============ -->
      <div id="gm-phase1">

        <!-- 뽑을 학생 설정 -->
        <div class="section">
          <div class="section-title">📋 뽑을 학생 설정</div>
          <div class="glass-card" style="padding: var(--space-lg);">
            <input type="hidden" id="gm-student-count" value="20">
            <div class="tag-student-gen-buttons">
              <button class="btn btn-secondary btn-sm" id="gm-gen-by-number">📝 번호순 생성</button>
              <button class="btn btn-secondary btn-sm" id="gm-gen-by-gender">👫 성별 구분</button>
              <button class="btn btn-secondary btn-sm" id="gm-gen-by-class">📋 학급 불러오기</button>
            </div>
            <div id="gm-student-cards" class="tag-student-cards"></div>
          </div>
        </div>

        <!-- 모둠 설정 -->
        <div class="section">
          <div class="section-title">⚙️ 모둠 설정</div>
          <div class="glass-card" style="padding: var(--space-lg);">
            <div class="tag-settings-4col">
              <div class="tag-setting-item">
                <div class="setting-label">모둠당 인원</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="gm-group-size" data-dir="down">−</button>
                  <input type="number" id="gm-group-size" value="4" min="2" max="10">
                  <button class="stepper-btn" data-target="gm-group-size" data-dir="up">+</button>
                </div>
              </div>
              <div class="tag-setting-item">
                <div class="setting-label">모둠 개수</div>
                <div class="number-stepper">
                  <button class="stepper-btn" data-target="gm-group-count" data-dir="down">−</button>
                  <input type="number" id="gm-group-count" value="5" min="1" max="12">
                  <button class="stepper-btn" data-target="gm-group-count" data-dir="up">+</button>
                </div>
              </div>
            </div>
            <div id="gm-calc-info" class="student-info" style="margin-top: var(--space-md);"></div>
          </div>
        </div>

        <!-- 모둠 이름 설정 -->
        <div class="section">
          <div class="section-title">🏷️ 모둠 이름 설정</div>
          <div class="glass-card" style="padding: var(--space-lg);">
            <div style="margin-bottom: var(--space-md);">
              <label
                style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">이름
                방식</label>
              <select id="gm-naming-mode" class="input" style="width: 100%;">
                <option value="number">숫자순 (1모둠, 2모둠, 3모둠...)</option>
                <option value="class">학급 설정 이름 사용</option>
                <option value="custom">즉석 커스텀</option>
              </select>
            </div>

            <!-- 학급 선택 (학급 설정 이름 모드일 때만) -->
            <div id="gm-class-name-select-container" style="display: none; margin-bottom: var(--space-md);">
              <label
                style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">학급
                선택</label>
              <select id="gm-class-name-select" class="input" style="width: 100%;">
                <option value="">학급 선택...</option>
              </select>
            </div>

            <!-- 즉석 커스텀 입력 -->
            <div id="gm-custom-names-container" style="display: none;">
              <label
                style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">모둠
                이름 입력</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-sm);">
                <input class="input gm-custom-name" type="text" placeholder="1번 모둠" maxlength="10">
                <input class="input gm-custom-name" type="text" placeholder="2번 모둠" maxlength="10">
                <input class="input gm-custom-name" type="text" placeholder="3번 모둠" maxlength="10">
                <input class="input gm-custom-name" type="text" placeholder="4번 모둠" maxlength="10">
                <input class="input gm-custom-name" type="text" placeholder="5번 모둠" maxlength="10">
                <input class="input gm-custom-name" type="text" placeholder="6번 모둠" maxlength="10">
              </div>
            </div>
          </div>
        </div>

        <!-- 모둠 뽑기 버튼 -->
        <button class="btn btn-primary btn-lg" id="gm-pick-btn" style="width: 100%; margin-bottom: var(--space-xl);">
          🎲 모둠 뽑기
        </button>

      </div>

      <!-- ============ Phase 2: 타이머 + 결과 ============ -->

      <!-- 타이머 (Phase 2 상단, 토글) -->
      <div id="gm-timer-section" class="section" style="display: none;">
        <div class="section-title">⏱ 타이머</div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div class="gm-timer-presets"
            style="display: flex; gap: var(--space-sm); flex-wrap: wrap; margin-bottom: var(--space-md);">
            <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="30">30초</button>
            <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="60">1분</button>
            <button class="btn btn-sm btn-secondary gm-timer-preset active" data-seconds="180">3분</button>
            <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="300">5분</button>
            <button class="btn btn-sm btn-secondary gm-timer-preset" data-seconds="600">10분</button>
          </div>
          <div style="display: flex; align-items: center; gap: var(--space-md);">
            <div id="gm-timer-display" class="gm-timer-display">03:00</div>
            <div style="display: flex; gap: var(--space-sm); flex: 1;">
              <button class="btn btn-sm btn-primary" id="gm-timer-start" style="flex:1;">▶ 시작</button>
              <button class="btn btn-sm btn-secondary" id="gm-timer-pause" style="flex:1; display:none;">⏸ 일시정지</button>
              <button class="btn btn-sm btn-secondary" id="gm-timer-reset">↺</button>
            </div>
          </div>
          <div style="margin-top: var(--space-md); text-align: center;">
            <button class="btn btn-sm btn-secondary" id="gm-timer-fullscreen">🖥 전체화면 타이머</button>
          </div>
        </div>
      </div>

      <!-- 결과 영역 -->
      <div id="gm-result-section" style="display: none;">
        <div class="section-title">🎯 모둠 뽑기 결과</div>
        <div id="gm-groups-container" class="gm-groups-container"></div>
      </div>

      <!-- Phase 2 액션 버튼 (4열 그리드) -->
      <div id="gm-phase2-actions" class="tag-phase2-grid" style="display: none;">
        <button class="btn btn-primary" id="gm-timer-toggle-btn">⏱ 타이머</button>
        <button class="btn btn-secondary" id="gm-pick-again-btn">🎲 다시뽑기</button>
        <button class="btn btn-secondary" id="gm-back-to-setup-btn">✏️ 설정</button>
        <button class="btn btn-danger" id="gm-reset-btn">🧹 초기화</button>
      </div>
    </div>

    <!-- ===================================================================
         ==================== 학급 설정 페이지 ====================
         =================================================================== -->
    <div id="page-settings" class="page-view">
      <div class="page-header">
        <div>
          <div class="page-title">학급 관리</div>
          <div class="page-subtitle">학급과 학생 명단을 관리합니다</div>
        </div>
      </div>

      <!-- 학급 목록 -->
      <div class="section">
        <div class="glass-card" style="padding: var(--space-lg);">
          <div id="settings-class-list" class="settings-class-list"></div>
          <button class="btn btn-primary btn-sm" id="settings-add-class"
            style="width: 100%; margin-top: var(--space-md);">
            + 새 학급 추가
          </button>
        </div>
      </div>

      <!-- 기본 모둠 이름 설정 -->
      <div class="section">
        <div class="section-title">🏷️ 기본 모둠 이름 설정</div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="margin-bottom: var(--space-sm); color: var(--text-secondary); font-size: var(--font-size-sm);">
            새 학급에 기본으로 적용될 모둠 이름입니다. 각 학급은 편집을 통해 개별적으로 수정할 수 있습니다.
          </div>
          <div
            style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-sm); margin-top: var(--space-md);">
            <input class="input" type="text" id="default-group-name-1" placeholder="1번 모둠" maxlength="10">
            <input class="input" type="text" id="default-group-name-2" placeholder="2번 모둠" maxlength="10">
            <input class="input" type="text" id="default-group-name-3" placeholder="3번 모둠" maxlength="10">
            <input class="input" type="text" id="default-group-name-4" placeholder="4번 모둠" maxlength="10">
            <input class="input" type="text" id="default-group-name-5" placeholder="5번 모둠" maxlength="10">
            <input class="input" type="text" id="default-group-name-6" placeholder="6번 모둠" maxlength="10">
          </div>
          <button class="btn btn-primary btn-sm" id="save-default-group-names"
            style="width: 100%; margin-top: var(--space-md);">
            저장
          </button>
        </div>
      </div>

      <!-- 앱 정보 -->
      <div class="section">
        <div class="section-title">ℹ️ 앱 정보</div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div class="setting-row">
            <div class="setting-label">체육 수업 도우미</div>
            <div style="font-size: var(--font-size-sm); color: var(--text-tertiary);">v1.0.0</div>
          </div>
          <div class="setting-row">
            <div class="setting-label">데이터 초기화</div>
            <button class="btn btn-sm btn-danger" id="settings-reset-data">초기화</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- 상단 네비바 (dock 대체) - app-container 밖에 배치 -->
  <!-- navbar는 body 끝이 아닌 상단 fixed로 동작 -->

  <!-- ====== Modals ====== -->

  <!-- 학급 편집 모달 -->
  <div id="class-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="class-modal-title">학급 편집</div>
        <button class="modal-close" id="class-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: var(--space-lg);">
          <label
            style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">학급
            이름</label>
          <input class="input" type="text" id="class-name-input" placeholder="예: 6학년 3반">
        </div>
        <div style="margin-bottom: var(--space-lg);">
          <label
            style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">
            학생 명단 <span style="font-weight: 400; color: var(--text-tertiary);">(한 줄에 한 명)</span>
          </label>
          <textarea class="input" id="class-students-input" rows="8"
            placeholder="김민준&#10;이서연&#10;박지호&#10;..."></textarea>
        </div>
        <div style="margin-bottom: var(--space-md);">
          <button class="btn btn-sm btn-secondary" id="class-csv-import" style="width: 100%;">
            📂 CSV/TXT 파일 가져오기
          </button>
          <input type="file" id="class-csv-file" accept=".csv,.txt" style="display: none;">
        </div>
        <div id="class-group-names-section" style="margin-bottom: var(--space-lg);">
          <label
            style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--space-sm);">
            모둠 이름 설정 <span style="font-weight: 400; color: var(--text-tertiary);">(최대 6개)</span>
          </label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-sm);">
            <input class="input" type="text" id="class-group-name-1" placeholder="1번 모둠" maxlength="10">
            <input class="input" type="text" id="class-group-name-2" placeholder="2번 모둠" maxlength="10">
            <input class="input" type="text" id="class-group-name-3" placeholder="3번 모둠" maxlength="10">
            <input class="input" type="text" id="class-group-name-4" placeholder="4번 모둠" maxlength="10">
            <input class="input" type="text" id="class-group-name-5" placeholder="5번 모둠" maxlength="10">
            <input class="input" type="text" id="class-group-name-6" placeholder="6번 모둠" maxlength="10">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="class-modal-cancel">취소</button>
        <button class="btn btn-primary" id="class-modal-save">저장</button>
      </div>
    </div>
  </div>

  <!-- 남는 학생 확인 모달 -->
  <div id="overflow-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" style="text-align: center; flex: 1;">남는 학생 안내</div>
        <button class="modal-close" id="overflow-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <p id="overflow-message" style="color: var(--text-secondary);"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="overflow-cancel">취소</button>
        <button class="btn btn-primary" id="overflow-confirm">확인</button>
      </div>
    </div>
  </div>

  <!-- 학생 부족 확인 모달 -->
  <div id="shortage-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">학생 수 부족</div>
        <button class="modal-close" id="shortage-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <p id="shortage-message" style="margin-bottom: var(--space-lg); color: var(--text-secondary);"></p>
      </div>
      <div class="modal-footer" style="flex-direction: column;">
        <button class="btn btn-primary" id="shortage-proceed" style="width: 100%;"></button>
        <button class="btn btn-secondary" id="shortage-alt" style="width: 100%;"></button>
        <button class="btn btn-secondary" id="shortage-cancel" style="width: 100%;">취소</button>
      </div>
    </div>
  </div>

  <!-- 번호순 생성 모달 (술래뽑기) -->
  <div id="tag-number-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">번호순 카드 생성</div>
        <button class="modal-close" id="tag-number-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: var(--space-md); align-items: center;">
          <div style="flex: 1;">
            <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
            <input class="input" type="number" id="tag-number-start" value="1" min="1" max="99"
              style="margin-top: var(--space-xs);">
          </div>
          <div style="flex: 1;">
            <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
            <input class="input" type="number" id="tag-number-end" value="20" min="1" max="99"
              style="margin-top: var(--space-xs);">
          </div>
        </div>
        <div style="font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: var(--space-md);">
          💡 시작~끝 번호로 학생 카드를 생성합니다
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="tag-number-modal-cancel">취소</button>
        <button class="btn btn-primary" id="tag-number-modal-confirm">카드 생성</button>
      </div>
    </div>
  </div>

  <!-- 성별 구분 모달 (술래뽑기) -->
  <div id="tag-gender-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">성별 구분 번호 입력</div>
        <button class="modal-close" id="tag-gender-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: var(--space-lg);">
          <div class="setting-label" style="margin-bottom: var(--space-sm); color: var(--color-primary);">👦 남학생</div>
          <div style="display: flex; gap: var(--space-md); align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
              <input class="input" type="number" id="tag-gender-male-start" value="1" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
              <input class="input" type="number" id="tag-gender-male-end" value="7" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
          </div>
        </div>
        <div>
          <div class="setting-label" style="margin-bottom: var(--space-sm); color: var(--color-danger);">👧 여학생</div>
          <div style="display: flex; gap: var(--space-md); align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
              <input class="input" type="number" id="tag-gender-female-start" value="41" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
              <input class="input" type="number" id="tag-gender-female-end" value="45" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="tag-gender-modal-cancel">취소</button>
        <button class="btn btn-primary" id="tag-gender-modal-confirm">카드 생성</button>
      </div>
    </div>
  </div>

  <!-- 학급 불러오기 모달 (술래뽑기) -->
  <div id="tag-class-select-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">학급 명단 불러오기</div>
        <button class="modal-close" id="tag-class-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <select id="tag-class-modal-select" class="input" style="width: 100%;">
          <option value="">학급 선택...</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="tag-class-modal-cancel">취소</button>
        <button class="btn btn-primary" id="tag-class-modal-confirm">불러오기</button>
      </div>
    </div>
  </div>

  <!-- 수동 입력 모달 (술래뽑기) -->
  <div id="manual-input-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="manual-input-title">수동 입력</div>
        <button class="modal-close" id="manual-input-close">✕</button>
      </div>
      <div class="modal-body">
        <textarea class="input" id="manual-input-text" rows="6"
          placeholder="학생 이름이나 번호를 쉼표로 구분하여 입력하세요&#10;예: 김철수, 이영희, 박민수 또는 1번, 2번, 3번"></textarea>
        <div style="font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: var(--space-sm);">
          💡 쉼표(,) 또는 줄바꿈으로 구분
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="manual-input-cancel">취소</button>
        <button class="btn btn-primary" id="manual-input-confirm">확인</button>
      </div>
    </div>
  </div>

  <!-- 번호순 생성 모달 (모둠뽑기) -->
  <div id="gm-number-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">번호순 카드 생성</div>
        <button class="modal-close" id="gm-number-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: var(--space-md); align-items: center;">
          <div style="flex: 1;">
            <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
            <input class="input" type="number" id="gm-number-start" value="1" min="1" max="99"
              style="margin-top: var(--space-xs);">
          </div>
          <div style="flex: 1;">
            <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
            <input class="input" type="number" id="gm-number-end" value="20" min="1" max="99"
              style="margin-top: var(--space-xs);">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="gm-number-modal-cancel">취소</button>
        <button class="btn btn-primary" id="gm-number-modal-confirm">카드 생성</button>
      </div>
    </div>
  </div>

  <!-- 성별 구분 모달 (모둠뽑기) -->
  <div id="gm-gender-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">성별 구분 번호 입력</div>
        <button class="modal-close" id="gm-gender-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: var(--space-lg);">
          <div class="setting-label" style="margin-bottom: var(--space-sm); color: var(--color-primary);">👦 남학생</div>
          <div style="display: flex; gap: var(--space-md); align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
              <input class="input" type="number" id="gm-gender-male-start" value="1" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
              <input class="input" type="number" id="gm-gender-male-end" value="7" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
          </div>
        </div>
        <div>
          <div class="setting-label" style="margin-bottom: var(--space-sm); color: var(--color-danger);">👧 여학생</div>
          <div style="display: flex; gap: var(--space-md); align-items: center;">
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">시작 번호</label>
              <input class="input" type="number" id="gm-gender-female-start" value="41" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
            <div style="flex: 1;">
              <label style="font-size: var(--font-size-xs); color: var(--text-tertiary);">끝 번호</label>
              <input class="input" type="number" id="gm-gender-female-end" value="45" min="1" max="99"
                style="margin-top: var(--space-xs);">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="gm-gender-modal-cancel">취소</button>
        <button class="btn btn-primary" id="gm-gender-modal-confirm">카드 생성</button>
      </div>
    </div>
  </div>

  <!-- 학급 불러오기 모달 (모둠뽑기) -->
  <div id="gm-class-select-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">학급 명단 불러오기</div>
        <button class="modal-close" id="gm-class-modal-close">✕</button>
      </div>
      <div class="modal-body">
        <select id="gm-class-modal-select" class="input" style="width: 100%;">
          <option value="">학급 선택...</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="gm-class-modal-cancel">취소</button>
        <button class="btn btn-primary" id="gm-class-modal-confirm">불러오기</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/shared/store.js"></script>
  <script src="js/shared/sound.js"></script>
  <script src="js/shared/ui-utils.js"></script>
  <script src="js/shared/timer.js"></script>
  <script src="js/shared/ios-utils.js"></script>
  <script src="js/shared/class-manager.js"></script>
  <script src="js/tag-game/tag-game.js"></script>
  <script src="js/tag-game/tag-game-ui.js"></script>
  <script src="js/group-manager/group-manager.js"></script>
  <script src="js/group-manager/group-manager-ui.js"></script>
  <script src="js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(() => { });
    }
  </script>
</body>

</html>