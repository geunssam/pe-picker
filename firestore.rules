rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 사용자별 데이터 격리: 자기 문서만 읽기/쓰기
    match /users/{userId} {
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;

      // 학급 서브컬렉션
      match /classes/{classId} {
        allow read, write: if request.auth != null
                           && request.auth.uid == userId;

        // 학생 서브컬렉션
        match /students/{studentId} {
          allow read, write: if request.auth != null
                             && request.auth.uid == userId;
        }
      }

      // 뱃지 로그 서브컬렉션
      match /badgeLogs/{logId} {
        allow read, write: if request.auth != null
                           && request.auth.uid == userId;
      }

      // 온도계 설정 서브컬렉션
      match /thermostatSettings/{classId} {
        allow read, write: if request.auth != null
                           && request.auth.uid == userId;
      }
    }

    // 그 외 모든 경로 차단
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
